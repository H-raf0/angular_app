<nb-layout>
  <nb-layout-header fixed>
    <div class="header-container">
      <h1>Stock Dashboard</h1>
      <div class="header-right">
        <span class="balance">Balance: ${{ portfolio?.balance | number: '1.2-2' }}</span>
        <button nbButton status="success" (click)="openAddMoneyDialog()">
          <nb-icon icon="plus-outline"></nb-icon>
          Add Money
        </button>
      </div>
    </div>
  </nb-layout-header>

  <nb-layout-column>
    <div class="dashboard-container">
      <!-- Left Sidebar: Company List -->
      <div class="sidebar">
        <nb-card>
          <nb-card-header>Companies</nb-card-header>
          <nb-card-body>
            <nb-list>
              <nb-list-item
                *ngFor="let stock of stocks"
                [class.active]="selectedStock?.id === stock.id"
                (click)="selectStock(stock)"
              >
                <div class="company-item">
                  <strong>{{ stock.symbol }}</strong>
                  <small>{{ stock.name }}</small>
                </div>
              </nb-list-item>
            </nb-list>
          </nb-card-body>
        </nb-card>
      </div>

      <!-- Main Content: Stock Details -->
      <div class="main-content">
        @if (selectedStock) {
          <nb-card>
            <nb-card-header>
              <div class="stock-header">
                <div>
                  <h2>{{ selectedStock.name }} ({{ selectedStock.symbol }})</h2>
                  <p class="price">Price: ${{ selectedStock.price | number: '1.2-2' }}</p>
                  <p
                    class="change"
                    [class.positive]="selectedStock.change >= 0"
                    [class.negative]="selectedStock.change < 0"
                  >
                    {{ selectedStock.change >= 0 ? '+' : '' }}{{ selectedStock.change }}%
                  </p>
                </div>
              </div>
            </nb-card-header>
            <nb-card-body>
              <!-- Simple SVG Line Chart -->
              <div class="chart-container">
                <svg width="100%" height="200" viewBox="0 0 500 200" preserveAspectRatio="none">
                  <!-- Y-axis -->
                  <line x1="30" y1="10" x2="30" y2="180" stroke="#999" stroke-width="1" />
                  <!-- X-axis -->
                  <line x1="30" y1="180" x2="480" y2="180" stroke="#999" stroke-width="1" />

                  <!-- Price line -->
                  <polyline
                    [attr.points]="getChartPoints(selectedStock.priceHistory)"
                    fill="none"
                    stroke="#3366FF"
                    stroke-width="2"
                  />

                  <!-- Data points -->
                  <circle
                    *ngFor="let point of getChartCoordinates(selectedStock.priceHistory)"
                    [attr.cx]="point.x"
                    [attr.cy]="point.y"
                    r="3"
                    fill="#3366FF"
                  />
                </svg>
              </div>

              <!-- Buy Stock Section -->
              <div class="buy-section">
                <div class="quantity-input">
                  <label>Quantity:</label>
                  <input type="number" [(ngModel)]="buyQuantity" min="1" class="input-field" />
                </div>
                <p class="total-cost">
                  Total Cost: ${{ selectedStock.price * buyQuantity | number: '1.2-2' }}
                </p>
                <button
                  nbButton
                  status="primary"
                  (click)="buyStock(selectedStock)"
                  [disabled]="
                    buyQuantity <= 0 ||
                    selectedStock.price * buyQuantity > (portfolio?.balance || 0)
                  "
                >
                  <nb-icon icon="shopping-cart-outline"></nb-icon>
                  Buy
                </button>
              </div>

              <!-- Portfolio Holdings -->
              @if (portfolio && portfolio.stocks[selectedStock.symbol]) {
                <div class="holdings">
                  <h4>Your Holdings</h4>
                  <p>
                    You own {{ portfolio.stocks[selectedStock.symbol] }} shares worth ${{
                      selectedStock.price * portfolio.stocks[selectedStock.symbol] | number: '1.2-2'
                    }}
                  </p>
                </div>
              }
            </nb-card-body>
          </nb-card>
        } @else {
          <nb-card>
            <nb-card-body>
              <p>Select a company from the list to view details</p>
            </nb-card-body>
          </nb-card>
        }
      </div>
    </div>
  </nb-layout-column>

  <nb-layout-footer>
    <div class="footer">Â© Stock Dashboard - Demo</div>
  </nb-layout-footer>
</nb-layout>
